#!/usr/bin/python3
#
# Aggregate bans into subnet rules for fail2ban - unit tests
#
# Copyright 2025 Alexandre Rossi <niol@zincube.net>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along
# with this program; if not, see <https://www.gnu.org/licenses/>.


import importlib.machinery
import importlib.util
import ipaddress
import os
import sys
import unittest


TESTS_DIR = os.path.dirname(__file__)
spec = importlib.util.spec_from_loader(
    "f2bsubnet",
    importlib.machinery.SourceFileLoader(
        "f2bsubnet", os.path.join(TESTS_DIR, "..", "fail2ban-subnet")
    ),
)
f2bsubnet = importlib.util.module_from_spec(spec)
sys.modules[spec.name] = f2bsubnet
spec.loader.exec_module(f2bsubnet)


class F2bSubnetTests(unittest.TestCase):

    def load_ips(self, fn):
        ips = None
        with open(os.path.join(TESTS_DIR, fn)) as f:
            ips = [l.strip() for l in f]
        return ips

    def test_subnets_important(self):
        ips = [
            "192.168.238.100",
            "192.168.12.4",
            "192.168.13.234",
            "192.168.67.29",
            "192.168.12.64",
            "192.168.13.12",
            "192.168.48.0/22",
            "192.168.238.124",
            "192.168.67.31",
            "192.168.12.28",
            "192.168.238.144",
            "192.168.238.1",
        ]

        subnets, unimportant = f2bsubnet.subnets_important(3, ips)
        self.assertCountEqual(
            subnets.keys(),
            {
                ipaddress.IPv4Network("192.168.12.0/24"),
                ipaddress.IPv4Network("192.168.48.0/22"),
                ipaddress.IPv4Network("192.168.238.0/24"),
            },
        )

        self.assertCountEqual(
            unimportant,
            {
                ipaddress.IPv4Address("192.168.13.234"),
                ipaddress.IPv4Address("192.168.67.29"),
                ipaddress.IPv4Address("192.168.13.12"),
                ipaddress.IPv4Address("192.168.67.31"),
            },
        )

    def test_subnets_clustering_overidentify(self):
        self.assertCountEqual(
            f2bsubnet.subnets_cluster(
                [
                    ipaddress.IPv4Network("8.210.16.0/24"),
                    ipaddress.IPv4Network("8.210.176.0/22"),
                    ipaddress.IPv4Network("8.210.186.0/24"),
                ],
                f2bsubnet.V4_SEARCH_NETMASKS,
            ),
            {
                ipaddress.IPv4Network("8.210.16.0/24"),
                ipaddress.IPv4Network("8.210.176.0/20"),
            },
        )

    def test_subnets_clustering_firstlast(self):
        self.assertCountEqual(
            f2bsubnet.subnets_find_clusters(
                {
                    s: 0
                    for s in [
                        ipaddress.IPv4Network("1.2.3.0/24"),
                        ipaddress.IPv4Network("8.210.176.0/24"),
                        ipaddress.IPv4Network("8.210.178.0/24"),
                        ipaddress.IPv4Network("8.210.179.0/24"),
                        ipaddress.IPv4Network("8.210.186.0/24"),
                        ipaddress.IPv4Network("123.95.4.0/24"),
                    ]
                },
                22,
            ),
            {
                ipaddress.IPv4Network("1.2.3.0/24"),
                ipaddress.IPv4Network("8.210.176.0/22"),
                ipaddress.IPv4Network("8.210.186.0/24"),
                ipaddress.IPv4Network("123.95.4.0/24"),
            },
        )

    def test_subnets_clustering_smallexample(self):
        ips = [ip for ip in self.load_ips("ai-bots") if ip.startswith("8.210.")]
        subnets_defs, unimportant = f2bsubnet.subnets_important(4, ips)
        subnets = list(subnets_defs.keys())
        self.assertCountEqual(
            subnets,
            {
                ipaddress.IPv4Network("8.210.176.0/24"),
                ipaddress.IPv4Network("8.210.178.0/24"),
                ipaddress.IPv4Network("8.210.179.0/24"),
                ipaddress.IPv4Network("8.210.186.0/24"),
            },
        )

        self.assertCountEqual(
            f2bsubnet.subnets_find_clusters({s: 0 for s in subnets}, 22),
            {
                ipaddress.IPv4Network("8.210.176.0/22"),
                ipaddress.IPv4Network("8.210.186.0/24"),
            },
        )

        self.assertCountEqual(
            f2bsubnet.subnets_find_clusters({s: 0 for s in subnets}, 20),
            {
                ipaddress.IPv4Network("8.210.176.0/20"),
            },
        )

        self.assertCountEqual(
            f2bsubnet.subnets_cluster(
                subnets,
                f2bsubnet.V4_SEARCH_NETMASKS,
            ),
            {
                ipaddress.IPv4Network("8.210.176.0/20"),
            },
        )

    def test_subnets_grow_over_non_nets(self):
        clustered = f2bsubnet.bad_networks(
            7,
            [
                "169.159.210.192",
                "169.197.34.126",
                "169.224.0.0/18",
                "169.224.0.199",
                "169.224.104.153",
                "169.224.104.164",
                "169.224.104.200",
                "169.224.104.66",
                "169.224.104.71",
                "169.224.105.164",
                "169.224.105.28",
                "169.224.105.35",
                "169.224.10.60",
                "169.224.106.198",
                "169.224.119.42",
                "169.224.120.127",
                "169.224.120.161",
                "169.224.120.28",
                "169.224.12.100",
                "169.224.63.82",
                "169.224.121.200",
                "169.224.121.38",
                "169.224.12.190",
                "169.224.1.232",
            ],
        )
        self.assertCountEqual(
            clustered.keys(),
            {
                ipaddress.IPv4Network("169.224.0.0/18"),
            },
        )
        self.assertCountEqual(
            clustered[ipaddress.IPv4Network("169.224.0.0/18")],
            {
                ipaddress.IPv4Network("169.224.0.0/18"),
                ipaddress.IPv4Address("169.224.0.199"),
                ipaddress.IPv4Address("169.224.12.190"),
                ipaddress.IPv4Address("169.224.10.60"),
                ipaddress.IPv4Address("169.224.1.232"),
                ipaddress.IPv4Address("169.224.12.100"),
                ipaddress.IPv4Address("169.224.63.82"),
            },
        )

    def test_no_overlap(self):
        clustered = f2bsubnet.bad_networks(
            7,
            [
                "169.224.5.0/24",
                "169.224.1.0/24",
                "169.224.67.112",
                "169.224.66.221",
                "169.224.66.97",
                "169.224.66.192",
                "169.224.66.214",
                "169.224.66.57",
                "169.224.66.131",
                "169.224.66.244",
                "169.224.10.170",
                "169.224.117.238",
                "169.224.64.167",
                "169.224.100.165",
                "169.224.89.8",
                "169.224.50.213",
                "169.224.6.196",
                "169.224.67.8",
                "169.224.22.75",
                "169.224.82.3",
                "169.224.2.231",
                "169.224.15.210",
                "169.224.16.171",
                "169.224.82.118",
                "169.224.119.181",
                "169.224.34.157",
                "169.224.94.0/24",
                "169.224.30.0/24",
                "169.224.33.239",
                "169.224.35.86",
                "169.224.15.109",
                "169.224.18.31",
                "169.224.19.150",
                "169.224.33.130",
                "169.224.118.52",
                "169.224.124.254",
                "169.224.198.14",
                "169.224.15.8",
                "169.224.6.62",
                "169.224.100.237",
                "169.224.34.18",
                "169.224.124.97",
                "169.224.35.145",
                "169.224.22.40",
                "169.224.15.246",
                "169.224.19.140",
                "169.224.107.185",
                "169.224.64.4",
                "169.224.110.216",
                "169.224.100.1",
                "169.224.18.236",
                "169.224.17.20",
                "169.224.35.9",
                "169.224.98.101",
                "169.224.18.86",
                "169.224.107.242",
                "169.224.113.158",
                "169.224.15.228",
                "169.224.88.185",
                "169.224.88.235",
                "169.224.88.19",
                "169.224.88.65",
                "169.224.88.236",
                "169.224.88.88",
                "169.224.88.150",
                "169.224.117.147",
                "169.224.2.78",
                "169.224.22.72",
                "169.224.126.43",
                "169.224.81.49",
                "169.224.2.216",
                "169.224.35.85",
                "169.224.15.136",
                "169.224.33.149",
                "169.224.98.154",
                "169.224.64.194",
                "169.224.64.240",
                "169.224.64.7",
                "169.224.64.64",
                "169.224.64.173",
                "169.224.64.236",
                "169.224.64.206",
                "169.224.100.253",
                "169.224.7.235",
                "169.224.16.1",
                "169.224.22.150",
                "169.224.17.238",
                "169.224.80.13",
                "169.224.122.194",
                "169.224.2.90",
                "169.224.7.39",
                "169.224.22.30",
                "169.224.2.220",
                "169.224.0.21",
                "169.224.122.89",
                "169.224.116.155",
                "169.224.19.123",
                "169.224.19.159",
                "169.224.122.117",
                "169.224.2.115",
                "169.224.2.7",
                "169.224.9.75",
                "169.224.13.0/24",
                "169.224.19.79",
                "169.224.17.196",
                "169.224.18.211",
                "169.224.80.40",
                "169.224.0.136",
                "169.224.18.159",
                "169.224.22.203",
                "169.224.119.18",
                "169.224.98.112",
                "169.224.2.205",
                "169.224.86.0/24",
                "169.224.68.29",
                "169.224.0.241",
                "169.224.22.192",
                "169.224.68.249",
                "169.224.125.168",
                "169.224.65.200",
                "169.224.17.194",
                "169.224.0.34",
                "169.224.65.214",
                "169.224.126.105",
                "169.224.4.173",
                "169.224.33.132",
                "169.224.32.32",
                "169.224.89.137",
                "169.224.0.4",
                "169.224.97.19",
                "169.224.2.38",
                "169.224.116.214",
                "169.224.100.154",
                "169.224.120.141",
                "169.224.7.35",
                "169.224.107.80",
                "169.224.22.182",
                "169.224.19.11",
                "169.224.110.165",
                "169.224.65.170",
                "169.224.124.166",
                "169.224.4.11",
                "169.224.18.29",
                "169.224.81.237",
                "169.224.89.20",
                "169.224.83.248",
                "169.224.81.98",
                "169.224.0.245",
                "169.224.83.166",
                "169.224.105.97",
                "169.224.82.44",
                "169.224.95.11",
                "169.224.0.3",
                "169.224.8.123",
                "169.224.81.219",
                "169.224.15.178",
                "169.224.2.251",
                "169.224.95.142",
                "169.224.0.110",
                "169.224.83.249",
                "169.224.116.182",
                "169.224.33.43",
                "169.224.117.125",
                "169.224.67.211",
                "169.224.4.136",
                "169.224.0.97",
                "169.224.2.5",
                "169.224.2.135",
                "169.224.17.92",
                "169.224.16.126",
                "169.224.22.164",
                "169.224.3.163",
                "169.224.117.210",
                "169.224.80.185",
                "169.224.19.16",
                "169.224.110.27",
                "169.224.18.196",
                "169.224.68.175",
                "169.224.22.56",
                "169.224.2.159",
                "169.224.3.56",
                "169.224.68.131",
                "169.224.95.5",
                "169.224.105.54",
                "169.224.18.82",
                "169.224.17.38",
                "169.224.4.110",
                "169.224.97.124",
                "169.224.7.196",
                "169.224.3.37",
                "169.224.32.137",
                "169.224.118.26",
                "169.224.32.195",
                "169.224.17.42",
                "169.224.17.52",
                "169.224.87.0/24",
                "169.224.106.0/24",
                "169.224.19.213",
                "169.224.10.160",
                "169.224.122.193",
                "169.224.33.93",
                "169.224.4.218",
                "169.224.65.6",
                "169.224.120.228",
                "169.224.3.180",
                "169.224.3.168",
                "169.224.0.39",
                "169.224.15.48",
                "169.224.3.12",
                "169.224.18.147",
                "169.224.32.97",
                "169.224.4.98",
                "169.224.3.8",
                "169.224.7.100",
                "169.224.2.25",
                "169.224.118.197",
                "169.224.0.152",
                "169.224.32.171",
                "169.224.32.227",
                "169.224.81.88",
                "169.224.3.76",
                "169.224.5.27",
                "169.224.34.29",
                "169.224.15.195",
                "169.224.2.130",
                "169.224.22.177",
                "169.224.122.78",
                "169.224.65.126",
                "169.224.122.153",
                "169.224.120.70",
                "169.224.5.128",
                "169.224.68.72",
                "169.224.33.1",
                "169.224.4.194",
                "169.224.23.0/24",
                "169.224.2.132",
                "169.224.2.31",
                "169.224.2.14",
                "169.224.2.253",
                "169.224.2.170",
                "169.224.2.147",
                "169.224.2.77",
                "169.224.2.252",
                "169.224.2.255",
                "169.224.2.229",
                "169.224.0.130",
                "169.224.0.165",
                "169.224.0.69",
                "169.224.0.7",
                "169.224.0.122",
                "169.224.0.21",
                "169.224.0.191",
                "169.224.0.31",
                "169.224.0.205",
                "169.224.0.94",
                "169.224.0.47",
                "169.224.0.244",
                "169.224.3.238",
                "169.224.5.147",
                "169.224.19.6",
                "169.224.18.187",
                "169.224.5.249",
                "169.224.4.59",
                "169.224.1.38",
                "169.224.1.194",
                "169.224.22.183",
                "169.224.4.188",
                "169.224.4.178",
                "169.224.5.97",
                "169.224.1.96",
                "169.224.22.135",
                "169.224.1.234",
                "169.224.4.130",
                "169.224.22.39",
                "169.224.16.250",
                "169.224.4.158",
                "169.224.1.175",
                "169.224.1.57",
                "169.224.22.13",
                "169.224.16.177",
                "169.224.3.85",
                "169.224.19.122",
                "169.224.4.29",
                "169.224.19.22",
                "169.224.5.66",
                "169.224.4.134",
                "169.224.5.58",
                "169.224.19.211",
                "169.224.16.33",
                "169.224.5.176",
                "169.224.19.250",
                "169.224.22.23",
                "169.224.5.190",
                "169.224.4.76",
                "169.224.1.150",
                "169.224.4.124",
                "169.224.1.5",
                "169.224.19.138",
                "169.224.18.104",
                "169.224.16.242",
                "169.224.22.28",
                "169.224.22.146",
                "169.224.5.143",
                "169.224.18.207",
                "169.224.5.120",
                "169.224.1.252",
                "169.224.4.86",
                "169.224.16.189",
                "169.224.18.6",
                "169.224.4.49",
                "169.224.4.43",
                "169.224.16.64",
                "169.224.16.138",
                "169.224.3.220",
                "169.224.3.242",
                "169.224.4.82",
                "169.224.18.33",
                "169.224.5.211",
                "169.224.4.165",
                "169.224.1.54",
                "169.224.22.90",
                "169.224.3.201",
                "169.224.1.80",
                "169.224.18.247",
                "169.224.4.143",
                "169.224.22.235",
                "169.224.3.124",
                "169.224.22.117",
                "169.224.3.195",
                "169.224.1.42",
                "169.224.1.197",
                "169.224.4.131",
                "169.224.16.88",
                "169.224.5.5",
                "169.224.22.103",
                "169.224.19.46",
                "169.224.5.91",
                "169.224.5.131",
                "169.224.5.161",
                "169.224.18.38",
                "169.224.18.218",
            ],
        )
        self.assertCountEqual(
            clustered.keys(),
            {
                ipaddress.IPv4Network("169.224.0.0/16"),
            },
        )

    def test_overlap_from_below(self):
        clustered = f2bsubnet.bad_networks(
            7,
            [
                "157.100.64.0/18",
                "157.100.198.99",
                "157.100.198.124",
                "157.100.198.176",
                "157.100.198.35",
                "157.100.198.118",
                "157.100.198.31",
                "157.100.198.50",
            ],
        )
        self.assertCountEqual(
            clustered.keys(),
            {
                ipaddress.IPv4Network("157.100.0.0/16"),
            },
        )

    def test_subnets_clustering_biglist(self):
        ips = self.load_ips("ai-bots")

        self.maxDiff = None
        subnets, unimportant = f2bsubnet.subnets_important(4, ips)
        self.assertCountEqual(
            subnets.keys(),
            {
                ipaddress.IPv4Network("8.210.176.0/24"),
                ipaddress.IPv4Network("8.210.178.0/24"),
                ipaddress.IPv4Network("8.210.179.0/24"),
                ipaddress.IPv4Network("8.210.186.0/24"),
                ipaddress.IPv4Network("27.115.124.0/24"),
                ipaddress.IPv4Network("40.77.167.0/24"),
                ipaddress.IPv4Network("45.177.154.0/24"),
                ipaddress.IPv4Network("45.228.136.0/24"),
                ipaddress.IPv4Network("45.230.9.0/24"),
                ipaddress.IPv4Network("45.230.165.0/24"),
                ipaddress.IPv4Network("47.82.11.0/24"),
                ipaddress.IPv4Network("47.239.171.0/24"),
                ipaddress.IPv4Network("47.242.20.0/24"),
                ipaddress.IPv4Network("47.242.45.0/24"),
                ipaddress.IPv4Network("47.242.53.0/24"),
                ipaddress.IPv4Network("47.242.55.0/24"),
                ipaddress.IPv4Network("47.242.57.0/24"),
                ipaddress.IPv4Network("47.242.58.0/24"),
                ipaddress.IPv4Network("47.242.61.0/24"),
                ipaddress.IPv4Network("47.242.62.0/24"),
                ipaddress.IPv4Network("47.242.64.0/24"),
                ipaddress.IPv4Network("47.242.78.0/24"),
                ipaddress.IPv4Network("47.242.86.0/24"),
                ipaddress.IPv4Network("47.242.128.0/24"),
                ipaddress.IPv4Network("47.242.129.0/24"),
                ipaddress.IPv4Network("47.242.131.0/24"),
                ipaddress.IPv4Network("47.242.133.0/24"),
                ipaddress.IPv4Network("47.242.135.0/24"),
                ipaddress.IPv4Network("47.242.139.0/24"),
                ipaddress.IPv4Network("47.242.140.0/24"),
                ipaddress.IPv4Network("47.242.161.0/24"),
                ipaddress.IPv4Network("47.242.208.0/24"),
                ipaddress.IPv4Network("47.242.210.0/24"),
                ipaddress.IPv4Network("47.242.211.0/24"),
                ipaddress.IPv4Network("47.242.214.0/24"),
                ipaddress.IPv4Network("47.242.222.0/24"),
                ipaddress.IPv4Network("47.242.229.0/24"),
                ipaddress.IPv4Network("47.242.248.0/24"),
                ipaddress.IPv4Network("47.243.11.0/24"),
                ipaddress.IPv4Network("47.243.29.0/24"),
                ipaddress.IPv4Network("47.243.50.0/24"),
                ipaddress.IPv4Network("47.243.70.0/24"),
                ipaddress.IPv4Network("47.243.78.0/24"),
                ipaddress.IPv4Network("47.243.105.0/24"),
                ipaddress.IPv4Network("47.243.195.0/24"),
                ipaddress.IPv4Network("47.243.200.0/24"),
                ipaddress.IPv4Network("47.243.207.0/24"),
                ipaddress.IPv4Network("47.243.251.0/24"),
                ipaddress.IPv4Network("52.167.144.0/24"),
                ipaddress.IPv4Network("101.91.110.0/24"),
                ipaddress.IPv4Network("101.199.254.0/24"),
                ipaddress.IPv4Network("104.210.140.0/24"),
                ipaddress.IPv4Network("138.59.226.0/24"),
                ipaddress.IPv4Network("138.117.221.0/24"),
                ipaddress.IPv4Network("143.0.56.0/24"),
                ipaddress.IPv4Network("146.174.160.0/24"),
                ipaddress.IPv4Network("146.174.161.0/24"),
                ipaddress.IPv4Network("146.174.162.0/24"),
                ipaddress.IPv4Network("146.174.163.0/24"),
                ipaddress.IPv4Network("146.174.164.0/24"),
                ipaddress.IPv4Network("146.174.165.0/24"),
                ipaddress.IPv4Network("146.174.166.0/24"),
                ipaddress.IPv4Network("146.174.167.0/24"),
                ipaddress.IPv4Network("146.174.168.0/24"),
                ipaddress.IPv4Network("146.174.169.0/24"),
                ipaddress.IPv4Network("146.174.170.0/24"),
                ipaddress.IPv4Network("146.174.171.0/24"),
                ipaddress.IPv4Network("146.174.172.0/24"),
                ipaddress.IPv4Network("146.174.173.0/24"),
                ipaddress.IPv4Network("146.174.174.0/24"),
                ipaddress.IPv4Network("146.174.175.0/24"),
                ipaddress.IPv4Network("146.174.176.0/24"),
                ipaddress.IPv4Network("146.174.177.0/24"),
                ipaddress.IPv4Network("146.174.178.0/24"),
                ipaddress.IPv4Network("146.174.179.0/24"),
                ipaddress.IPv4Network("146.174.180.0/24"),
                ipaddress.IPv4Network("146.174.181.0/24"),
                ipaddress.IPv4Network("146.174.182.0/24"),
                ipaddress.IPv4Network("146.174.183.0/24"),
                ipaddress.IPv4Network("146.174.184.0/24"),
                ipaddress.IPv4Network("146.174.185.0/24"),
                ipaddress.IPv4Network("146.174.186.0/24"),
                ipaddress.IPv4Network("146.174.187.0/24"),
                ipaddress.IPv4Network("146.174.188.0/24"),
                ipaddress.IPv4Network("146.174.189.0/24"),
                ipaddress.IPv4Network("146.174.190.0/24"),
                ipaddress.IPv4Network("146.174.191.0/24"),
                ipaddress.IPv4Network("148.222.194.0/24"),
                ipaddress.IPv4Network("157.55.39.0/24"),
                ipaddress.IPv4Network("167.249.242.0/24"),
                ipaddress.IPv4Network("170.78.118.0/24"),
                ipaddress.IPv4Network("170.82.50.0/24"),
                ipaddress.IPv4Network("170.245.133.0/24"),
                ipaddress.IPv4Network("170.246.69.0/24"),
                ipaddress.IPv4Network("170.247.38.0/24"),
                ipaddress.IPv4Network("177.37.180.0/24"),
                ipaddress.IPv4Network("177.87.32.0/24"),
                ipaddress.IPv4Network("177.181.4.0/24"),
                ipaddress.IPv4Network("177.220.172.0/24"),
                ipaddress.IPv4Network("181.91.84.0/24"),
                ipaddress.IPv4Network("181.199.54.0/24"),
                ipaddress.IPv4Network("186.158.200.0/24"),
                ipaddress.IPv4Network("187.16.187.0/24"),
                ipaddress.IPv4Network("187.180.212.0/24"),
                ipaddress.IPv4Network("189.126.47.0/24"),
                ipaddress.IPv4Network("190.102.47.0/24"),
                ipaddress.IPv4Network("191.243.89.0/24"),
                ipaddress.IPv4Network("202.76.160.0/24"),
                ipaddress.IPv4Network("202.76.161.0/24"),
                ipaddress.IPv4Network("202.76.162.0/24"),
                ipaddress.IPv4Network("202.76.163.0/24"),
                ipaddress.IPv4Network("202.76.164.0/24"),
                ipaddress.IPv4Network("202.76.165.0/24"),
                ipaddress.IPv4Network("202.76.166.0/24"),
                ipaddress.IPv4Network("202.76.167.0/24"),
                ipaddress.IPv4Network("207.46.13.0/24"),
                ipaddress.IPv4Network("216.98.214.0/24"),
            },
        )

        clustered = f2bsubnet.bad_networks(4, ips)
        self.assertCountEqual(
            clustered.keys(),
            {
                ipaddress.IPv4Network("8.210.176.0/20"),
                ipaddress.IPv4Network("27.115.124.0/24"),
                ipaddress.IPv4Network("40.77.167.0/24"),
                ipaddress.IPv4Network("45.177.154.0/24"),
                ipaddress.IPv4Network("45.228.136.0/24"),
                ipaddress.IPv4Network("45.230.9.0/24"),
                ipaddress.IPv4Network("45.230.165.0/24"),
                ipaddress.IPv4Network("47.82.11.0/24"),
                ipaddress.IPv4Network("47.239.171.0/24"),
                ipaddress.IPv4Network("47.242.0.0/16"),
                ipaddress.IPv4Network("47.243.0.0/16"),
                ipaddress.IPv4Network("52.167.144.0/24"),
                ipaddress.IPv4Network("101.91.110.0/24"),
                ipaddress.IPv4Network("101.199.254.0/24"),
                ipaddress.IPv4Network("104.210.140.0/24"),
                ipaddress.IPv4Network("138.59.226.0/24"),
                ipaddress.IPv4Network("138.117.221.0/24"),
                ipaddress.IPv4Network("143.0.56.0/24"),
                ipaddress.IPv4Network("146.174.128.0/18"),
                ipaddress.IPv4Network("148.222.194.0/24"),
                ipaddress.IPv4Network("157.55.39.0/24"),
                ipaddress.IPv4Network("167.249.242.0/24"),
                ipaddress.IPv4Network("170.78.118.0/24"),
                ipaddress.IPv4Network("170.82.50.0/24"),
                ipaddress.IPv4Network("170.245.133.0/24"),
                ipaddress.IPv4Network("170.246.69.0/24"),
                ipaddress.IPv4Network("170.247.38.0/24"),
                ipaddress.IPv4Network("177.37.180.0/24"),
                ipaddress.IPv4Network("177.87.32.0/24"),
                ipaddress.IPv4Network("177.181.4.0/24"),
                ipaddress.IPv4Network("177.220.172.0/24"),
                ipaddress.IPv4Network("181.91.84.0/24"),
                ipaddress.IPv4Network("181.199.54.0/24"),
                ipaddress.IPv4Network("186.158.200.0/24"),
                ipaddress.IPv4Network("187.16.187.0/24"),
                ipaddress.IPv4Network("187.180.212.0/24"),
                ipaddress.IPv4Network("189.126.47.0/24"),
                ipaddress.IPv4Network("190.102.47.0/24"),
                ipaddress.IPv4Network("191.243.89.0/24"),
                ipaddress.IPv4Network("202.76.160.0/20"),
                ipaddress.IPv4Network("207.46.13.0/24"),
                ipaddress.IPv4Network("216.98.214.0/24"),
            },
        )


if __name__ == "__main__":
    unittest.main(verbosity=2)
